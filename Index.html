<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vokabeltrainer Pro V11</title>
    <style>
        :root { 
            --primary: #007AFF; 
            --success: #34C759; 
            --danger: #FF3B30; 
            --bg: #F2F2F7; 
            --card-bg: #FFFFFF;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            margin: 0; 
            padding: 10px; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            color: #1C1C1E;
        }

        .container { width: 100%; max-width: 500px; padding-bottom: 50px; }

        /* Header & Set-Management */
        .box { 
            background: var(--card-bg); 
            padding: 15px; 
            border-radius: 15px; 
            margin-bottom: 15px; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.05); 
        }
        
        h3 { margin: 0 0 10px 0; font-size: 18px; }

        select, input { 
            width: 100%; 
            padding: 12px; 
            margin: 5px 0; 
            border: 1px solid #D1D1D6; 
            border-radius: 10px; 
            box-sizing: border-box; 
            font-size: 16px;
            -webkit-appearance: none;
        }

        /* Buttons */
        button { 
            padding: 15px; 
            border-radius: 12px; 
            border: none; 
            font-size: 15px; 
            font-weight: 600; 
            cursor: pointer; 
            transition: opacity 0.2s, transform 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:active { opacity: 0.7; transform: scale(0.98); }
        
        .btn-blue { background: var(--primary); color: white; }
        .btn-green { background: var(--success); color: white; }
        .btn-red { background: var(--danger); color: white; }
        .btn-gray { background: #E5E5EA; color: #000; }
        .btn-dark { background: #3A3A3C; color: white; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }

        /* Modi-Umschalter */
        .mode-bar { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; padding-bottom: 5px; }
        .mode-bar button { flex: 1; padding: 10px; font-size: 13px; white-space: nowrap; }
        .active-mode { background: var(--primary); color: white; }

        /* Karteikarte */
        .card-container { width: 100%; height: 320px; perspective: 1000px; margin: 15px 0; }
        .card-inner { 
            position: relative; width: 100%; height: 100%; 
            transition: transform 0.5s; transform-style: preserve-3d; 
        }
        .flipped { transform: rotateY(180deg); }
        
        .card-front, .card-back { 
            position: absolute; width: 100%; height: 100%; 
            backface-visibility: hidden; border-radius: 20px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 20px; box-sizing: border-box; text-align: center; 
            background: white; box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .card-back { transform: rotateY(180deg); background: #F9F9FB; }
        
        .card-text { font-size: 26px; font-weight: 700; word-break: break-word; }
        .card-img { max-width: 100%; max-height: 160px; border-radius: 12px; margin-bottom: 15px; object-fit: contain; }

        /* Listenansicht */
        #listView { display: none; }
        .list-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .list-table th, .list-table td { padding: 12px; text-align: left; border-bottom: 1px solid #E5E5EA; }
        .search-box { position: sticky; top: 0; background: white; z-index: 10; }

        /* Feedback Pr√ºfung */
        .test-feedback { text-align: center; font-weight: bold; margin-top: 10px; min-height: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="box">
        <h3>Lern-Set</h3>
        <select id="setSelect" onchange="switchSet()"></select>
        <div style="display:flex; gap:8px; margin-top:10px;">
            <input type="text" id="newSetName" placeholder="Name f√ºr neues Set..." style="margin:0;">
            <button class="btn-blue" onclick="handleCreateSet()" style="padding:0 20px;">+</button>
        </div>
        <div id="statsDisplay" style="text-align:center; font-size:13px; margin-top:12px; color:#666; font-weight:600;">0 / 0 gelernt</div>
    </div>

    <div class="mode-bar">
        <button id="m-learn" class="btn-dark active-mode" onclick="changeAppMode('learn')">Lernen</button>
        <button id="m-focus" class="btn-dark" onclick="changeAppMode('focus')">Fokus</button>
        <button id="m-test" class="btn-dark" onclick="changeAppMode('test')">Pr√ºfung</button>
        <button id="m-list" class="btn-dark" onclick="changeAppMode('list')">Liste</button>
    </div>

    <div id="view-main">
        <div class="card-container" id="cardElement" onclick="handleCardFlip()">
            <div class="card-inner" id="cardInner">
                <div class="card-front" id="cardFront"></div>
                <div class="card-back" id="cardBack"></div>
            </div>
        </div>

        <div id="test-controls" style="display:none;" class="box">
            <input type="text" id="testInput" placeholder="Antwort eintippen..." onkeyup="if(event.key==='Enter') evaluateTest()">
            <button class="btn-blue" style="width:100%; margin-top:10px;" onclick="evaluateTest()">Pr√ºfen</button>
            <div id="testFeedback" class="test-feedback"></div>
        </div>

        <div id="learn-controls">
            <div class="grid-2">
                <button class="btn-red" onclick="setCardStatus(false)">‚ùå Nicht gewusst</button>
                <button class="btn-green" onclick="setCardStatus(true)">‚úÖ Gewusst!</button>
            </div>
            <div class="grid-2">
                <button class="btn-gray" onclick="navigate(-1)">‚¨Ö Zur√ºck</button>
                <button class="btn-gray" onclick="navigate(1)">Weiter ‚û°</button>
            </div>
            <div class="grid-2">
                <button class="btn-gray" onclick="toggleDirection()">üîÑ Richtung</button>
                <button class="btn-gray" onclick="handleShuffle()">üîÄ Mischen</button>
            </div>
        </div>
    </div>

    <div id="view-list" class="box" style="display:none;">
        <div class="search-box">
            <input type="text" id="listSearch" placeholder="In Liste suchen..." onkeyup="refreshListView()">
        </div>
        <div style="max-height: 400px; overflow-y: auto;">
            <table class="list-table">
                <thead><tr><th>Vorne</th><th>Hinten</th><th>Aktion</th></tr></thead>
                <tbody id="listBody"></tbody>
            </table>
        </div>
    </div>

    <div class="box">
        <h3>Neue Karte hinzuf√ºgen</h3>
        <input type="text" id="addFront" placeholder="Vorderseite (z.B. Deutsch)">
        <input type="text" id="addBack" placeholder="R√ºckseite (z.B. Englisch)">
        <div style="font-size:12px; color:#666; margin-top:5px;">Optionales Bild:</div>
        <input type="file" id="addFile" accept="image/*">
        <button id="addBtn" class="btn-blue" style="width:100%; margin-top:12px;" onclick="handleAddCard()">Karte Speichern</button>
        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
        <button class="btn-red" style="width:100%; font-size:12px; padding:8px;" onclick="handleDeleteSet()">Gesamtes Set l√∂schen</button>
    </div>
</div>

<script>
    // Datenstruktur & Initialisierung
    let data = JSON.parse(localStorage.getItem('voca_v11')) || { "Mein Set": [] };
    let currentSet = localStorage.getItem('voca_last_set') || Object.keys(data)[0];
    let index = 0;
    let isReverse = false;
    let appMode = 'learn'; // learn, focus, test, list
    let lastImageBase64 = "";

    // Bild-Handling
    document.getElementById('addFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => { lastImageBase64 = ev.target.result; };
        reader.readAsDataURL(file);
    });

    // Kern-Funktionen
    function saveAndRefresh() {
        localStorage.setItem('voca_v11', JSON.stringify(data));
        localStorage.setItem('voca_last_set', currentSet);
        renderUI();
    }

    function handleCreateSet() {
        const name = document.getElementById('newSetName').value.trim();
        if (name && !data[name]) {
            data[name] = [];
            currentSet = name;
            index = 0;
            document.getElementById('newSetName').value = "";
            saveAndRefresh();
        }
    }

    function handleAddCard() {
        const f = document.getElementById('addFront').value.trim();
        const b = document.getElementById('addBack').value.trim();
        
        if (!f || !b) {
            alert("Vorder- und R√ºckseite werden ben√∂tigt!");
            return;
        }

        if (!data[currentSet]) data[currentSet] = [];
        
        data[currentSet].push({
            f: f,
            b: b,
            img: lastImageBase64,
            known: false
        });

        // Felder sofort leeren
        document.getElementById('addFront').value = "";
        document.getElementById('addBack').value = "";
        document.getElementById('addFile').value = "";
        lastImageBase64 = "";

        const btn = document.getElementById('addBtn');
        btn.innerText = "Gespeichert! ‚úÖ";
        setTimeout(() => { btn.innerText = "Karte Speichern"; }, 1000);

        saveAndRefresh();
    }

    function changeAppMode(m) {
        appMode = m;
        index = 0;
        document.querySelectorAll('.mode-bar button').forEach(b => b.classList.remove('active-mode'));
        document.getElementById('m-' + m).classList.add('active-mode');
        renderUI();
    }

    function getFilteredCards() {
        const all = data[currentSet] || [];
        if (appMode === 'focus') return all.filter(c => !c.known);
        if (appMode === 'test') return all.filter(c => !c.known);
        return all;
    }

    function renderUI() {
        // Dropdown aktualisieren
        const sel = document.getElementById('setSelect');
        sel.innerHTML = "";
        Object.keys(data).forEach(s => {
            const o = document.createElement('option');
            o.value = s; o.innerText = s;
            if (s === currentSet) o.selected = true;
            sel.appendChild(o);
        });

        const activeCards = getFilteredCards();
        const stats = document.getElementById('statsDisplay');
        const knownCount = (data[currentSet] || []).filter(c => c.known).length;
        const totalCount = (data[currentSet] || []).length;
        stats.innerText = `${knownCount} / ${totalCount} gelernt`;

        // Sichten umschalten
        document.getElementById('view-main').style.display = (appMode === 'list') ? 'none' : 'block';
        document.getElementById('view-list').style.display = (appMode === 'list') ? 'block' : 'none';
        document.getElementById('test-controls').style.display = (appMode === 'test') ? 'block' : 'none';
        document.getElementById('learn-controls').style.display = (appMode === 'test') ? 'none' : 'block';

        if (appMode === 'list') {
            refreshListView();
            return;
        }

        // Karte rendern
        const frontDiv = document.getElementById('cardFront');
        const backDiv = document.getElementById('cardBack');
        document.getElementById('cardInner').classList.remove('flipped');
        document.getElementById('testFeedback').innerText = "";
        document.getElementById('testInput').value = "";

        if (activeCards.length === 0) {
            frontDiv.innerHTML = `<div class="card-text" style="color:#ccc;">${appMode === 'focus' ? 'Alle Karten gelernt!' : 'Set ist leer'}</div>`;
            backDiv.innerHTML = "---";
            return;
        }

        if (index >= activeCards.length) index = 0;
        const card = activeCards[index];

        const displayF = isReverse ? card.b : card.f;
        const displayB = isReverse ? card.f : card.b;
        const imgTag = card.img ? `<img src="${card.img}" class="card-img">` : "";

        frontDiv.innerHTML = `${imgTag}<div class="card-text">${displayF}</div>`;
        backDiv.innerHTML = `<div class="card-text">${displayB}</div>`;
    }

    function handleCardFlip() {
        if (appMode !== 'test') {
            document.getElementById('cardInner').classList.toggle('flipped');
        }
    }

    function navigate(step) {
        const cards = getFilteredCards();
        if (cards.length === 0) return;
        index = (index + step + cards.length) % cards.length;
        renderUI();
    }

    function setCardStatus(known) {
        const cards = getFilteredCards();
        if (cards[index]) {
            cards[index].known = known;
            saveAndRefresh();
            if (known) navigate(1);
        }
    }

    function evaluateTest() {
        const cards = getFilteredCards();
        if (!cards[index]) return;

        const card = cards[index];
        const correct = isReverse ? card.f : card.b;
        const input = document.getElementById('testInput').value.trim();
        const feedback = document.getElementById('testFeedback');

        if (input.toLowerCase() === correct.toLowerCase()) {
            feedback.style.color = "var(--success)";
            feedback.innerText = "Richtig! ‚úÖ";
            card.known = true;
            saveAndRefresh();
            setTimeout(() => { navigate(1); }, 800);
        } else {
            feedback.style.color = "var(--danger)";
            feedback.innerText = `Falsch! L√∂sung: ${correct}`;
            document.getElementById('cardInner').classList.add('flipped');
        }
    }

    function toggleDirection() { isReverse = !isReverse; renderUI(); }

    function handleShuffle() {
        if (!data[currentSet]) return;
        data[currentSet].sort(() => Math.random() - 0.5);
        index = 0;
        saveAndRefresh();
    }

    function refreshListView() {
        const body = document.getElementById('listBody');
        const search = document.getElementById('listSearch').value.toLowerCase();
        body.innerHTML = "";
        
        (data[currentSet] || []).forEach((c, i) => {
            if (c.f.toLowerCase().includes(search) || c.b.toLowerCase().includes(search)) {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${c.f}</td>
                    <td>${c.b}</td>
                    <td><button class="btn-red" onclick="deleteSingleCard(${i})" style="padding:5px 10px; font-size:12px;">L√∂schen</button></td>
                `;
                body.appendChild(tr);
            }
        });
    }

    function deleteSingleCard(i) {
        data[currentSet].splice(i, 1);
        saveAndRefresh();
    }

    function handleDeleteSet() {
        if (confirm(`Set "${currentSet}" wirklich unwiderruflich l√∂schen?`)) {
            delete data[currentSet];
            if (Object.keys(data).length === 0) data["Mein Set"] = [];
            currentSet = Object.keys(data)[0];
            index = 0;
            saveAndRefresh();
        }
    }

    function switchSet() {
        currentSet = document.getElementById('setSelect').value;
        index = 0;
        saveAndRefresh();
    }

    // Start
    renderUI();
</script>

</body>
</html>
